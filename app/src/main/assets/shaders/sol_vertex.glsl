// ============================================
// โ๏ธ SOL - VERTEX SHADER CON DEFORMACIรN SUTIL
// Burbujas solares + Ondulaciรณn orgรกnica
// ============================================

#ifdef GL_ES
precision mediump float;
#endif

attribute vec4 a_Position;
attribute vec2 a_TexCoord;

uniform mat4 u_MVP;
uniform float u_Time;

varying vec2 v_TexCoord;
varying vec3 v_WorldPos;

// ============================================
// ๐ง FUNCIONES DE RUIDO 3D
// ============================================

float hash(vec3 p) {
    return fract(sin(dot(p, vec3(127.1, 311.7, 74.7))) * 43758.5453);
}

float noise3D(vec3 p) {
    vec3 i = floor(p);
    vec3 f = fract(p);
    f = f * f * (3.0 - 2.0 * f);

    float n000 = hash(i);
    float n100 = hash(i + vec3(1.0, 0.0, 0.0));
    float n010 = hash(i + vec3(0.0, 1.0, 0.0));
    float n110 = hash(i + vec3(1.0, 1.0, 0.0));
    float n001 = hash(i + vec3(0.0, 0.0, 1.0));
    float n101 = hash(i + vec3(1.0, 0.0, 1.0));
    float n011 = hash(i + vec3(0.0, 1.0, 1.0));
    float n111 = hash(i + vec3(1.0, 1.0, 1.0));

    float x00 = mix(n000, n100, f.x);
    float x10 = mix(n010, n110, f.x);
    float x01 = mix(n001, n101, f.x);
    float x11 = mix(n011, n111, f.x);

    float y0 = mix(x00, x10, f.y);
    float y1 = mix(x01, x11, f.y);

    return mix(y0, y1, f.z);
}

// ============================================
// ๐ MAIN - DEFORMACIรN ORGรNICA SUTIL
// ============================================

void main() {
    // Posiciรณn original del vรฉrtice
    vec3 pos = a_Position.xyz;

    // Normal (direcciรณn desde el centro hacia el vรฉrtice)
    vec3 normal = normalize(pos);

    // Tiempo muy lento para movimiento suave
    float time = u_Time * 0.05;

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // 1๏ธโฃ BURBUJAS GRANDES (convecciรณn solar lenta)
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    vec3 noisePos1 = pos * 2.0 + vec3(time * 0.1);
    float bubble1 = noise3D(noisePos1);

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // 2๏ธโฃ BURBUJAS MEDIANAS (detalles medios)
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    vec3 noisePos2 = pos * 4.0 + vec3(-time * 0.15, time * 0.12, time * 0.08);
    float bubble2 = noise3D(noisePos2);

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // 3๏ธโฃ COMBINAR BURBUJAS
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    // Mezclar capas (centradas en 0.0)
    float displacement = (bubble1 - 0.5) * 0.7 + (bubble2 - 0.5) * 0.3;

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // 4๏ธโฃ APLICAR DEFORMACIรN MUY SUTIL (1.5% mรกximo)
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    pos += normal * displacement * 0.015;  // Solo 1.5% de deformaciรณn

    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    // 5๏ธโฃ OUTPUT
    // โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

    gl_Position = u_MVP * vec4(pos, 1.0);
    v_TexCoord = a_TexCoord;
    v_WorldPos = pos;
}
